---
title: Christmas tree in ggplot
author: DrMowinckel
date: '2018-12-13'
output:
  html_document:
    keep_md: yes
categories:
  - R
tags: []
featured_image: '/blog/2018-12-13-christmas-tree-in-ggplot_files/figure-html/featured-1.gif' 

---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>It’s Christmas! And I love Christmas! Pretty snow, cozy fires, fairy lights, family, friends and love. It’s just filled with all times of lovely things.</p>
<p>That also means… PLOTS! You might know from my previous posts that I love plotting. A bit too much, but it truly is a lovely thing to create a great plot.</p>
<p>So, a while ago, the amazing <a href="rladies.org">RLadies</a> network showed me this cool thing a stats professor does each Christmas at the end of his visualisation lecture, I knew I had to do it! You can see all the lovely submissions he has <a href="http://smarterpoland.pl/index.php/2017/12/christmas-trees/">here</a>.</p>
<p>So here is my process for making the Christmas tree in ggplot.</p>
<div id="the-tree-cone" class="section level2">
<h2>The tree cone</h2>
<p>First, lest just make a triangle and make it green!</p>
<pre class="r"><code>library(tidyverse, quietly = T)</code></pre>
<pre><code>## ── Attaching packages ──────────────────────────────────────────────────────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.0     ✓ purrr   0.3.4
## ✓ tibble  3.0.1     ✓ dplyr   0.8.5
## ✓ tidyr   1.0.3     ✓ stringr 1.4.0
## ✓ readr   1.3.1     ✓ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ─────────────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>cone = data.frame(x = 1:9,
                  y = c(1:5,4:1)) %&gt;% 
  na.omit() %&gt;% 
  arrange(x)

cone %&gt;% 
  ggplot(aes(x=x, y=y)) +
  geom_polygon(fill=&quot;#213c18&quot;)</code></pre>
<p><img src="/blog/2018-12-13-christmas-tree-in-ggplot/index_files/figure-html/unnamed-chunk-1-1.png" width="384" /></p>
</div>
<div id="add-some-fancy-stuff" class="section level2">
<h2>Add some fancy stuff</h2>
<p>This as acutally meant to alter the cone and get the distinct Christmas tree shape, but I couldn’t manage the little “dips” at each branch, the wrong points kept connecting.
So it enved up with this more abstract, contemporary thing, which I actually really like!</p>
<pre class="r"><code>fancy = cone %&gt;% 
  mutate(xoff = ifelse(x&lt;5, x+.4, ifelse(x&gt;5, x-.4, NA))) %&gt;% 
  gather(del, x, contains(&quot;x&quot;)) %&gt;% 
  mutate(y = ifelse(del==&quot;xoff&quot;, y-.1,y)) %&gt;% 
  filter(y&gt;=1) %&gt;% 
  na.omit() %&gt;% 
  select(-del) %&gt;% 
  arrange(y)

cone %&gt;% 
  ggplot(aes(x=x, y=y)) +
  geom_polygon(fill=&quot;#213c18&quot;) +
  geom_polygon(data=fancy, fill = &quot;#668c6f&quot;)</code></pre>
<p><img src="/blog/2018-12-13-christmas-tree-in-ggplot/index_files/figure-html/unnamed-chunk-2-1.png" width="384" /></p>
</div>
<div id="baubles" class="section level2">
<h2>BAUBLES!</h2>
<p>What christmas tree would it be without some baubles!
We define some nice christmas’y colours, do some data sample-randomness stuff, and voila!</p>
<pre class="r"><code>library(gganimate, quietly = T)

# Define bauble colours
bauble_colours = c(&quot;#e5d08f&quot;, &quot;#e3d4b6&quot;,
                   &quot;#cacbce&quot;, &quot;#9c9c9c&quot;, &quot;#e1dfdf&quot;,
                   &quot;#c94c4c&quot;, &quot;#8d1414&quot;)

baubles = cone %&gt;% 
  
  # Group by y, nest and make up some random values for x.
  group_by(y) %&gt;% 
  nest() %&gt;% 
  mutate(data =  map(data, ~data.frame(x=seq(min(.$x), max(.$x), by=.1)))) %&gt;% 
  unnest() %&gt;% 
  
  # Group by x, nest and make up some random values for y.
  group_by(x) %&gt;% 
  nest() %&gt;% 
  mutate(data =  map(data, ~data.frame(y=seq(min(.$y), max(.$y), by=.1)))) %&gt;% 
  unnest() %&gt;% 
  ungroup() %&gt;% 
  
  # Give baubles random shapes, sizes and two different colours.
  mutate(col1 = sample(bauble_colours, nrow(.), replace = T),
         col2 = sample(bauble_colours, nrow(.), replace = T),
         shp = sample(1:7, nrow(.), replace = T),
         sz = sample(seq(.5,2,by=.1), nrow(.), replace = T),
         time = sample(seq(.5,1,by=.01), nrow(.), replace = T)
  ) %&gt;%
  rownames_to_column() %&gt;% 
  
  # Grab only 60 baubles
  sample_n(60) %&gt;% 
  
  # Gather the colours into a single column
  gather(dd, cols, contains(&quot;col&quot;)) %&gt;% 
  mutate(alph = ifelse(dd == &quot;col1&quot;, .8, 1))</code></pre>
<pre><code>## Warning: `cols` is now required.
## Please use `cols = c(data)`

## Warning: `cols` is now required.
## Please use `cols = c(data)`</code></pre>
<pre class="r"><code>cone %&gt;% 
  ggplot(aes(x=x, y=y)) +
  geom_polygon(fill=&quot;#213c18&quot;) +
  geom_polygon(data=fancy, fill = &quot;#668c6f&quot;) +
  geom_point(data = baubles, aes(colour=I(cols), fill=I(cols), 
                                 shape = factor(shp),size=sz), show.legend = F) + 
  scale_shape_manual(values = c(20:25,8))</code></pre>
<p><img src="/blog/2018-12-13-christmas-tree-in-ggplot/index_files/figure-html/unnamed-chunk-3-1.png" width="384" /></p>
</div>
<div id="add-the-topper-and-animate-some-sparkly" class="section level2">
<h2>Add the topper and animate some sparkly!</h2>
<p>We need a tree topper, in Norway, we usually add the Christmas star.
And then I wanted some ornaments to seemlingly sparkle a little, so we add a small animation too!</p>
<pre class="r"><code>cone %&gt;% 
  ggplot(aes(x=x, y=y)) +
  
  # Cone
  geom_polygon(fill=&quot;#213c18&quot;) +
  
  # Fancy
  geom_polygon(data=fancy, fill = &quot;#668c6f&quot;) +
  
  # Baubles
  geom_point(data = baubles %&gt;% select(-time), show.legend = F, alpha = .7,
             aes(colour=I(cols), fill=I(cols),
                 shape = factor(shp),size=sz, group=rowname)) +
  
  # animated baubles!
  geom_point(data = baubles, show.legend = F,
             aes(colour=I(cols), fill=I(cols), alpha=I(alph),
                 shape = factor(shp),size=sz, group=rowname)) + 
  
  # Topper
  geom_point(data=data.frame(x=5, y=5), colour=&quot;#e5d08f&quot;, size=15, shape=8) +
  scale_shape_manual(values = c(20:25,8)) +
  
  # remove axes etc., and make background black
  theme_void() + 
  theme(plot.background = element_rect(fill=&quot;black&quot;), title = element_text(colour=&quot;white&quot;)) +
  
  # Animate
  #transition_states(time, transition_length = 10, state_length = 2) + 
  transition_time(time) + 
  ease_aes(&#39;quadratic-in-out&#39;) </code></pre>
<p><img src="/blog/2018-12-13-christmas-tree-in-ggplot/index_files/figure-html/unnamed-chunk-4-1.gif" /><!-- --></p>
</div>
<div id="the-snow" class="section level2">
<h2>The snow!</h2>
<p>I also wanted to have some snow falling in the background.</p>
<pre class="r"><code>snow = data.frame(x = sample(seq(1, max(cone$x)+1, by=.01), 100, replace = F),
                  y = sample(seq(1, max(cone$y)+1, by=.01), 100, replace = F)) %&gt;% 
  group_by(x) %&gt;% 
  nest() %&gt;% 
  mutate(data =  map(data, 
                     ~data.frame(y=seq(.$y, .$y-sample(seq(.5,1,by=.01),1), length.out = 100)) %&gt;% 
                       mutate(time = sample(seq(0.5,.9, .01), 1)) %&gt;% 
                       mutate(time = seq(unique(time), unique(time)+.02, length.out = nrow(.)))
  )) %&gt;% 
  unnest() </code></pre>
<pre><code>## Warning: `cols` is now required.
## Please use `cols = c(data)`</code></pre>
<pre class="r"><code>cone %&gt;% 
  ggplot(aes(x=x, y=y)) +
  
  # Snow
  geom_jitter(data=snow, aes(group=x), colour=&quot;white&quot;, shape=8, size=1) +
  
  # Cone
  geom_polygon(fill=&quot;#213c18&quot;) +
  
  # Fancy
  geom_polygon(data=fancy, fill = &quot;#668c6f&quot;) +
  
  # Baubles
  geom_point(data = baubles %&gt;% select(-time), show.legend = F, alpha = .7,
             aes(colour=I(cols), fill=I(cols),
                 shape = factor(shp),size=sz, group=rowname)) +
  
  # animated baubles!
  geom_point(data = baubles, show.legend = F,
             aes(colour=I(cols), fill=I(cols), alpha=I(alph),
                 shape = factor(shp),size=sz, group=rowname)) +
  
  # Topper
  geom_point(data=data.frame(x=5, y=5), colour=&quot;#e5d08f&quot;, size=15, shape=8) +
  scale_shape_manual(values = c(20:25,8)) +
  
  # remove axes etc., and make background black
  theme_void() + 
  theme(plot.background = element_rect(fill=&quot;black&quot;), title = element_text(colour=&quot;white&quot;)) +
  
  # Animate
  transition_time(time) + 
  ease_aes(&#39;sine-in-out&#39;) </code></pre>
<p><img src="/blog/2018-12-13-christmas-tree-in-ggplot/index_files/figure-html/featured-1.gif" /><!-- --></p>
<p>There you go! My little Christmas tree!</p>
</div>
<div id="merry-christmas-yall" class="section level1">
<h1>Merry Christmas, y’all!</h1>
</div>
